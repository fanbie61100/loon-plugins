#!name=酷安去广告
#!desc=屏蔽热词、开屏广告、推广广告、首页广告、评论广告、商品推广、酷品页推广，简化账号主页
#!icon=https://raw.githubusercontent.com/luestr/IconResource/main/App_icon/120px/CoolApk.png
#!tag=去广告,酷安

[Rewrite]

# > 酷安_屏蔽搜索页热词（直接拦截接口，返回空数据）
^https?:\/\/api\.coolapk\.com\/v6\/search\?.*type=hotSearch - reject-200

# > 酷安_屏蔽搜索页热词（备用方案，部分版本兼容）
^https:\/\/api\.coolapk\.com\/v6\/search\?.*type=hotSearch reject-dict

# > 酷安_动态详情页：去热门评论广告 + 清空商品推广字段
^https:\/\/api\.coolapk\.com\/v6\/feed\/detail\? response-body-json-jq '.data.hotReplyRows |= if . then map(select(.id?)) else . end | .data.topReplyRows |= if . then map(select(.id?)) else . end | reduce ("detailSponsorCard", "include_goods", "include_goods_ids") as $key (.; .data[$key]=[])'

# > 酷安_动态详情页（重复规则，增强不同参数顺序下的命中率）
^https:\/\/api\.coolapk\.com\/v6\/feed\/detail\? response-body-json-jq '.data.hotReplyRows |= if . then map(select(.id?)) else . end | .data.topReplyRows |= if . then map(select(.id?)) else . end | reduce ("detailSponsorCard", "include_goods", "include_goods_ids") as $key (.; .data[$key]=[])'

# > 酷安_首页信息流：移除 sponsorCard 与「精选配件」
^https:\/\/api\.coolapk\.com\/v6\/main\/dataList response-body-json-jq '.data |= (if (type=="array" and length>0) then map(select((.entityTemplate!="sponsorCard") and (.title!="精选配件"))) else . end)'

# > 酷安_通用页面流：去酷安热搜 / 图片卡 / 赞助卡
^https:\/\/api\.coolapk\.com\/v6\/page\/dataList response-body-json-jq 'if (.data | length > 0) then .data |= map(select((.title? != "酷安热搜") and (.entityTemplate? != "imageScaleCard") and (.entityTemplate? != "sponsorCard"))) else . end'

# > 酷安_通用页面流（重复规则，防止部分页面漏匹配）
^https:\/\/api\.coolapk\.com\/v6\/page\/dataList response-body-json-jq 'if (.data | length > 0) then .data |= map(select((.title? != "酷安热搜") and (.entityTemplate? != "imageScaleCard") and (.entityTemplate? != "sponsorCard"))) else . end'

# > 酷安_启动初始化：移除指定运营位 entityId，并隐藏「酷品」入口
^https:\/\/api\.coolapk\.com\/v6\/main\/init response-body-json-jq '.data |= map(select(.entityId? | [944,945,6390] | index(.) | not) | if .entityId == 20131 then .entities |= map(select(.title != "酷品")) else . end)'

[Script]

# > 酷安_开屏广告（启动页广告清除）
http-response ^https?:\/\/api.coolapk.com\/v6\/main\/init script-path=https://github.com/ddgksf2013/Scripts/raw/master/coolapk.js, requires-body=true, timeout=60, tag=开屏广告

# > 酷安_推广广告（信息流通用广告）
http-response ^https?:\/\/api.coolapk.com\/v6\/dataList script-path=https://github.com/ddgksf2013/Scripts/raw/master/coolapk.js, requires-body=true, timeout=60, tag=推广广告

# > 酷安_首页广告（首页推荐流广告）
http-response ^https?:\/\/api.coolapk.com\/v6\/main\/indexV8 script-path=https://github.com/ddgksf2013/Scripts/raw/master/coolapk.js, requires-body=true, timeout=60, tag=首页广告

# > 酷安_评论广告（评论区夹杂推广）
http-response ^https?:\/\/api.coolapk.com\/v6\/feed\/replyList script-path=https://github.com/ddgksf2013/Scripts/raw/master/coolapk.js, requires-body=true, timeout=60, tag=评论广告

# > 酷安_商品推广（动态内商品卡片）
http-response ^https?:\/\/api.coolapk.com\/v6\/feed\/detail script-path=https://github.com/ddgksf2013/Scripts/raw/master/coolapk.js, requires-body=true, timeout=60, tag=商品推广

# > 酷安_酷品页推广（title 命中酷品相关页面）
http-response https://api.coolapk.com/v6/page/dataList\?.*title=%E9%85 script-path=https://github.com/ddgksf2013/Scripts/raw/master/coolapk.js, requires-body=true, timeout=60, tag=酷品页推广

# > 酷安_个人主页（精简“我的”页面卡片）
http-response ^https:\/\/api\.coolapk\.com\/v6\/account\/loadConfig\?key=my_page_card_config requires-body=1,script-path=https://raw.githubusercontent.com/fanbie61100/loon-js/refs/heads/main/KuAn.js,tag=个人主页

[MITM]

# > 酷安接口域名，Rewrite / Script 生效必需
hostname = api.coolapk.com
